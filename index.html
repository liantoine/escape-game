<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>ALERTE - Désamorçage en cours</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        /* Fond ambiance désamorçage de bombe */
        body { 
            background: #1a0505; 
            color: #ff4d4d; 
            font-family: 'Courier New', monospace; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0;
            overflow: hidden;
        }
        
        /* Effet de clignotement subtil en arrière-plan */
        @keyframes alert-bg {
            0% { background: #1a0505; }
            50% { background: #2d0a0a; }
            100% { background: #1a0505; }
        }
        body { animation: alert-bg 2s infinite; }

        #terminal { 
            border: 3px solid #ff0000; 
            padding: 30px; 
            background: #000; 
            box-shadow: 0 0 30px #ff0000; 
            width: 90%; 
            max-width: 550px; 
            text-align: center;
        }

        h2 { text-transform: uppercase; letter-spacing: 2px; }

        input { 
            background: #220000; 
            border: 1px solid #ff0000; 
            color: #ff0000; 
            padding: 15px; 
            width: 100%; 
            box-sizing: border-box; 
            margin-top: 20px; 
            font-size: 1.2em;
            outline: none;
        }

        button { 
            background: #ff0000; 
            color: #000; 
            border: none; 
            padding: 15px; 
            width: 100%; 
            margin-top: 15px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1em;
            transition: background 0.3s;
        }

        button:hover { background: #cc0000; }

        #msg { margin-top: 20px; font-weight: bold; min-height: 1.2em; }
        
        .timer { font-size: 2em; color: #ff0000; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div id="terminal">
        <div class="timer">T-MINUS: 15:00</div>
        <h2 id="title">> UNITÉ DE CONTRÔLE</h2>
        <p id="instruction">Énigme 1 : Calculez le déterminant de la matrice [[2, 5], [1, 3]] pour stopper l'amorce.</p>
        
        <input type="text" id="code" placeholder="Entrez le code numérique..." autocomplete="off">
        <button onclick="check()">VALIDER LE CODE</button>
        
        <p id="msg"></p>
    </div>

    <script>
        // On stocke les étapes du jeu
        let etapeActuelle = 1;

        // Hashs des réponses
        const reponses = {
            1: "6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b", // Résultat : 1
            2: "d2d2d2d0590a590595d2c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3c3" // Résultat à définir (ici exemple)
        };

        // Note : Pour l'étape 2, énigme sur la Matrice Inverse comme dans le livret [cite: 1303, 1304]
        const enigma2Hash = "ef2d127de37b942baad06145e54b0c619a1f22327b2ebbcfbec78f5564afe39d"; // Hash de "1217"

        function check() {
            const input = document.getElementById("code").value.trim();
            const hash = CryptoJS.SHA256(input).toString();
            const msg = document.getElementById("msg");
            
            if (etapeActuelle === 1) {
                if (hash === reponses[1]) {
                    success("CODE 1 ACCEPTÉ. Accès au noyau...");
                    setTimeout(chargerEtape2, 1500);
                } else {
                    error();
                }
            } else if (etapeActuelle === 2) {
                if (hash === enigma2Hash) {
                    finalWin();
                } else {
                    error();
                }
            }
        }

        function chargerEtape2() {
            etapeActuelle = 2;
            document.getElementById("title").innerText = "> PROTOCOLE D'INVERSION";
            document.getElementById("instruction").innerText = "Énigme 2 : Trouvez les coefficients f et g de la matrice inverse A⁻¹ = fA + gI. Concaténez f et g (ex: 12 et 17 donne 1217).";
            document.getElementById("code").value = "";
            document.getElementById("msg").innerText = "";
            document.getElementById("terminal").style.borderColor = "#ff0000";
        }

        function success(texte) {
            const msg = document.getElementById("msg");
            msg.innerHTML = texte;
            msg.style.color = "#00ff00";
            document.getElementById("terminal").style.borderColor = "#00ff00";
        }

        function error() {
            const msg = document.getElementById("msg");
            msg.innerHTML = "ERREUR CRITIQUE : Code invalide.";
            msg.style.color = "#ff0000";
            document.getElementById("terminal").style.borderColor = "red";
        }

        function finalWin() {
            document.getElementById("terminal").innerHTML = "<h2 style='color:#00ff00'>BOMBE DÉSAMORCÉE</h2><p>Le système est sécurisé. Félicitations, agents.</p>";
            document.body.style.animation = "none";
            document.body.style.background = "#001a00";
        }
    </script>
</body>
</html>
